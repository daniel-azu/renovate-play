"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.getNewValue = exports.toSemverRange = void 0;
const semver_1 = __importDefault(require("semver"));
const fromParam = /^\s*from\s*:\s*"([^"]+)"\s*$/;
const fromRange = /^\s*"([^"]+)"\s*\.\.\.\s*$/;
const binaryRange = /^\s*"([^"]+)"\s*(\.\.[.<])\s*"([^"]+)"\s*$/;
const toRange = /^\s*(\.\.[.<])\s*"([^"]+)"\s*$/;
function toSemverRange(range) {
    if (fromParam.test(range)) {
        const [, version] = fromParam.exec(range);
        if (semver_1.default.valid(version)) {
            const nextMajor = `${semver_1.default.major(version) + 1}.0.0`;
            return `>=${version} <${nextMajor}`;
        }
    }
    else if (fromRange.test(range)) {
        const [, version] = fromRange.exec(range);
        if (semver_1.default.valid(version)) {
            return `>=${version}`;
        }
    }
    else if (binaryRange.test(range)) {
        const [, currentVersion, op, newVersion] = binaryRange.exec(range);
        if (semver_1.default.valid(currentVersion) && semver_1.default.valid(newVersion)) {
            return op === '..<'
                ? `>=${currentVersion} <${newVersion}`
                : `>=${currentVersion} <=${newVersion}`;
        }
    }
    else if (toRange.test(range)) {
        const [, op, newVersion] = toRange.exec(range);
        if (semver_1.default.valid(newVersion)) {
            return op === '..<' ? `<${newVersion}` : `<=${newVersion}`;
        }
    }
    return null;
}
exports.toSemverRange = toSemverRange;
function getNewValue({ currentValue, currentVersion, newVersion, }) {
    if (fromParam.test(currentValue)) {
        return currentValue.replace(/".*?"/, `"${newVersion}"`);
    }
    if (fromRange.test(currentValue)) {
        const [, version] = fromRange.exec(currentValue);
        return currentValue.replace(version, newVersion);
    }
    if (binaryRange.test(currentValue)) {
        const [, , , version] = binaryRange.exec(currentValue);
        return currentValue.replace(version, newVersion);
    }
    if (toRange.test(currentValue)) {
        const [, , version] = toRange.exec(currentValue);
        return currentValue.replace(version, newVersion);
    }
    return currentValue;
}
exports.getNewValue = getNewValue;
//# sourceMappingURL=range.js.map