{"version":3,"file":"common.js","sourceRoot":"","sources":["../../../lib/datasource/rubygems/common.ts"],"names":[],"mappings":";;;;;;AAAA,sDAA8B;AAC9B,wDAA+B;AAC/B,yCAAsC;AACtC,0CAAuC;AACvC,wCAAgD;AAEnC,QAAA,EAAE,GAAG,UAAU,CAAC;AAChB,QAAA,IAAI,GAAG,IAAI,WAAI,CAAC,UAAE,CAAC,CAAC;AAEpB,QAAA,kBAAkB,GAAG,CAAC,yBAAyB,EAAE,YAAY,CAAC,CAAC;AAErE,KAAK,UAAU,SAAS,CAC7B,UAAkB,EAClB,QAAgB,EAChB,IAAY;IAEZ,MAAM,GAAG,GAAG,IAAA,kBAAO,EAAC,QAAQ,EAAE,IAAI,EAAE,GAAG,UAAU,OAAO,CAAC,CAAC;IAE1D,eAAM,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,EAAE,EAAE,yBAAyB,CAAC,CAAC;IACvE,MAAM,QAAQ,GAAG,CAAC,MAAM,YAAI,CAAC,OAAO,CAAI,GAAG,CAAC,CAAC,IAAI;QAC/C,IAAI,EAAE,SAAS;KAChB,CAAC;IAEF,OAAO,QAAQ,CAAC,IAAI,CAAC;AACvB,CAAC;AAbD,8BAaC;AAEM,KAAK,UAAU,WAAW,CAC/B,UAAkB,EAClB,QAAgB,EAChB,IAAY;IAEZ,MAAM,GAAG,GAAG,GAAG,IAAA,kBAAO,EAAC,QAAQ,EAAE,IAAI,CAAC,IAAI,IAAA,oBAAc,EAAC;QACvD,IAAI,EAAE,UAAU;KACjB,CAAC,EAAE,CAAC;IAEL,eAAM,CAAC,KAAK,CAAC,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG,EAAE,EAAE,yBAAyB,CAAC,CAAC;IACvE,MAAM,QAAQ,GAAG,MAAM,YAAI,CAAC,SAAS,CAAC,GAAG,CAAC,CAAC;IAE3C,OAAO,IAAI,iBAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC,MAAW,CAAC;AAChD,CAAC;AAbD,kCAaC","sourcesContent":["import Marshal from 'marshal';\nimport urlJoin from 'url-join';\nimport { logger } from '../../logger';\nimport { Http } from '../../util/http';\nimport { getQueryString } from '../../util/url';\n\nexport const id = 'rubygems';\nexport const http = new Http(id);\n\nexport const knownFallbackHosts = ['rubygems.pkg.github.com', 'gitlab.com'];\n\nexport async function fetchJson<T>(\n  dependency: string,\n  registry: string,\n  path: string\n): Promise<T> {\n  const url = urlJoin(registry, path, `${dependency}.json`);\n\n  logger.trace({ registry, dependency, url }, `RubyGems lookup request`);\n  const response = (await http.getJson<T>(url)) || {\n    body: undefined,\n  };\n\n  return response.body;\n}\n\nexport async function fetchBuffer<T>(\n  dependency: string,\n  registry: string,\n  path: string\n): Promise<T> {\n  const url = `${urlJoin(registry, path)}?${getQueryString({\n    gems: dependency,\n  })}`;\n\n  logger.trace({ registry, dependency, url }, `RubyGems lookup request`);\n  const response = await http.getBuffer(url);\n\n  return new Marshal(response.body).parsed as T;\n}\n"]}